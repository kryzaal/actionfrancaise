<% include head %>

<% include militez_tuiles %>

<div id="carte">
	<img id="fond" src="/style/images/map.png" />
</div>

<div id="carte_aside">
	<div id="navigation_rapide">
		<h2>NAVIGATION RAPIDE</h2>
	<select id="liste_sections" onChange="this.value.dataset."></select>
	</div>
	<div id="details"></div>

	<a href="/militez/creer"><button id="creermasection" type="button">Cr√©er ma section</button></a>
</div>

<script>
	var positions = {
		'bordeaux': {x: '150', y: '240'},
		'provence' : {x: '425', y: '130'},
		'iledefrance' : {x: '280', y: '460'},
		'annecy' : {x: '480', y: '320'},
		'clermont' : {x: '340', y: '280'},
		'grenoble': {x: '480', y: '240'},
		'lyon': {x: '420', y: '290'},
		'nantes': {x: '120', y: '370'},
		'rennes': {x: '120', y: '440'},
		'annonay': {x: '395', y: '230'},
		'oise-picardie': {x: '285', y: '530'},
		'aix-en-provence': {x: '470', y: '40'},
		'marseille': {x: '380', y: '40'}
	};

	var instances = {};

	function section(data) {
		try {
			this.data = data;
			this.position = positions[this.data.code];
			instances[this.data.code] = this;

			var blason_html = '<img class="blason" src="/entites/sections/' + this.data.code + '/blason"' +
				'style="bottom: ' + this.position.y + 'px; left: ' + this.position.x + 'px; z-index: ' + (1000 - this.position.y) + '"' +
				'onClick="draw(\'' + this.data.code + '\')"/>';
			var option_html = '<option name="' + this.data.code +'" value="' + this.data.code + '">' + this.data["nom_court"] + '</option>';
			$("#carte").append(blason_html);
			$("#liste_sections").append(option_html);
		} catch(e) {}
	}

	function federation(data) {
		try {
			console.log(JSON.stringify(data));
			this.data = data;
			this.position = positions[this.data.code];
			instances[this.data.code] = this;

			var blason_html = '<img class="blason" src="/entites/federations/' + this.data.code + '/blason"' +
				'style="bottom: ' + this.position.y + 'px; left: ' + this.position.x + 'px; z-index: ' + (1000 - this.position.y) + '"' +
				'onClick="draw(\'' + this.data.code + '\')"/>';
			var option_html = '<option name="' + this.data.code +'" value="' + this.data.code + '">' + this.data["nom_court"] + '</option>';
			$("#carte").append(blason_html);
			$("#liste_sections").append(option_html);
		} catch(e) {}
	}

	$(function() {
		$.ajax('/entites/sections', {accepts: "application/json"}).done(function(data) {
			data.forEach(function(code) {
				$.ajax('/entites/sections/' + code, {accepts: "application/json"}).done(function(data) {
					new section(data);
				});
			});
		});
		$.ajax('/entites/federations', {accepts: "application/json"}).done(function(data) {
			data.forEach(function(code) {
				$.ajax('/entites/federations/' + code, {accepts: "application/json"}).done(function(data) {
					new federation(data);
				});
			});
		});
	});
</script>

<% include foot %>