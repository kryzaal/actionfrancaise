<% include head %>

<div id="viewer">
	<div class="button" onclick="previous();"></div>
	<div id="image" onclick="collapse();"></div>
	<div class="button" onclick="next();"></div>
</div>

<div id="titre"><h1>Visuels, affiches et vid√©os</h1></div>

<div id="visuels">
	<% visuels.forEach(function(filename) { %>
		 <img src="/visuel/<%= filename %>" onClick="expand(this);"/>
	<% }); %>
</div>

<div id="videos">
	<% videos.forEach(function(code) {%>
		<div class="video_<%= code %>" onClick="loadVideo(this, '<%= code %>')"></div>
		<script>$('document').ready(function() {loadTitle('<%= code %>');});</script>
	<% }); %>
</div>

<script>
	var selectedImage = null;

	function expand(img) {
		selectedImage = img;
		$('#viewer > #image').css('background-image', "url('" + img.src + "')");
		$('#viewer').addClass('expanded');
	}

	function collapse() {
		selectedImage = null;
		$('#viewer > #image').css('background-image', 'none');
		$('#viewer').removeClass('expanded');
	}

	function previous() {
		var previousImg = $(selectedImage).prev();
		if(previousImg.length == 0) previousImg = $('#visuels img:last-child');
		expand(previousImg[0]);
	}

	function next() {
		var nextImg = $(selectedImage).next();
		if(nextImg.length == 0) nextImg = $('#visuels img:first-child');
		expand(nextImg[0]);
	}

	function loadVideo(parentDiv, code) {
		parentDiv.innerHTML = '<iframe src="http://www.youtube.com/embed/' + code + '?rel=0&autoplay=1" frameborder="0" allowfullscreen></iframe>';
	}

	function loadTitle(code) {
	    $.getJSON("http://gdata.youtube.com/feeds/api/videos/" + code + "?v=2&alt=jsonc", function(response) {
	    	$(".video_" + code).html('<img src="http://img.youtube.com/vi/' + code + '/0.jpg"/>' + '<h1>' + response.data.title + '</h1>');
	    });
	}

	$(function() {
		$('#random').remove();
		var hash = window.location.hash.substr(1);
		if(hash.length > 1) expand($('img[src="/visuel/' + hash + '"]')[0]);
	});
</script>

<% include foot %>